<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MPTEPL OEE Dashboard</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
    font-family: Arial;
    background: linear-gradient(120deg,#1e3c72,#2a5298);
    margin:0;
    padding:20px;
}
.container{
    max-width:1200px;
    margin:auto;
    background:#fff;
    padding:25px;
    border-radius:12px;
}
h2{text-align:center;color:#1e3c72;}
.top-bar{
    display:flex;
    justify-content:space-between;
    margin-bottom:15px;
}
button{
    padding:10px 15px;
    background:#1e3c72;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.cards{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:15px;
}
.card{
    padding:20px;
    border-radius:10px;
    text-align:center;
    font-weight:bold;
}
.avail{background:#ffeaa7;}
.perf{background:#81ecec;}
.qual{background:#a29bfe;}
.oee{background:#55efc4;font-size:22px;}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:25px;
}
th,td{
    border:1px solid #ddd;
    padding:10px;
    text-align:center;
}
th{background:#1e3c72;color:white;}
</style>
</head>

<body>

<div class="container">
<h2>ðŸ“Š MPTEPL OEE Dashboard (Live CSV)</h2>

<div class="top-bar">
    <b>Auto Data from GitHub CSV</b>
    <button onclick="exportExcel()">â¬‡ Export</button>
</div>

<div class="cards">
    <div class="card avail">Availability<br><span id="availability">0%</span></div>
    <div class="card perf">Performance<br><span id="performance">0%</span></div>
    <div class="card qual">Quality<br><span id="quality">0%</span></div>
    <div class="card oee">OEE<br><span id="oee">0%</span></div>
</div>

<table>
<thead>
<tr>
<th>Conveyor</th>
<th>Planned Time</th>
<th>Downtime</th>
<th>Ideal Cycle Time</th>
<th>Total Count</th>
<th>Good Count</th>
</tr>
</thead>
<tbody id="dataBody"></tbody>
</table>
</div>

<script>
const CSV_URL = "https://raw.githubusercontent.com/USERNAME/mptepl-oee-dashboard/main/oee_data.csv";

let excelData=[];

fetch(CSV_URL)
.then(r=>r.text())
.then(t=>{
    let rows=t.trim().split("\n");
    let headers=rows.shift().split(",");
    excelData=rows.map(r=>{
        let v=r.split(",");
        let o={};
        headers.forEach((h,i)=>o[h.trim()]=Number(v[i])||v[i]);
        return o;
    });
    loadTable();
    calculate();
});

function loadTable(){
    dataBody.innerHTML="";
    excelData.forEach(r=>{
        dataBody.innerHTML+=`
        <tr>
            <td>${r.Conveyor}</td>
            <td>${r.PlannedTime}</td>
            <td>${r.Downtime}</td>
            <td>${r.IdealCycleTime}</td>
            <td>${r.TotalCount}</td>
            <td>${r.GoodCount}</td>
        </tr>`;
    });
}

function calculate(){
    let A=0,P=0,Q=0;
    excelData.forEach(r=>{
        let op=r.PlannedTime-r.Downtime;
        A+=op/r.PlannedTime;
        P+=(r.IdealCycleTime*r.TotalCount)/op;
        Q+=r.GoodCount/r.TotalCount;
    });
    let c=excelData.length;
    let av=A/c, pe=P/c, qu=Q/c, oee=av*pe*qu;

    availability.textContent=(av*100).toFixed(2)+"%";
    performance.textContent=(pe*100).toFixed(2)+"%";
    quality.textContent=(qu*100).toFixed(2)+"%";
    oee.textContent=(oee*100).toFixed(2)+"%";
}

function exportExcel(){
    let ws=XLSX.utils.json_to_sheet(excelData);
    let wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"OEE");
    XLSX.writeFile(wb,"MPTEPL_OEE.xlsx");
}
</script>

</body>
</html>

