<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Employee Pulse Survey Portal</title>

<style>
body { font-family: Arial; background:"C:\Users\hrtrainer_u6\OneDrive - microplasticsindia.com\7. MPTEPL details\1. Photos\background.jpg.jpg"; }
.container { max-width:900px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
h2,h3,h4 { text-align:center; }
input, select { width:100%; padding:6px; margin:6px 0; }
button { padding:8px 14px; background:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer; }
button:hover { background:#0056b3; }
table { width:100%; border-collapse:collapse; margin-top:15px; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
.hidden { display:none; }
.nav { text-align:center; margin-bottom:15px; }
.nav button { margin:5px; }
</style>
</head>

<body>

<div class="container">
<h2>Employee Pulse Survey Portal</h2>

<div class="nav">
<button onclick="showEmpLogin()">Employee Access</button>
<button onclick="showHRAdminLogin()">HR Admin Access</button>
</div>

<!-- ================= EMPLOYEE LOGIN ================= -->
<div id="empLogin">
<h3>Employee Login</h3>
<input type="text" id="empNoLogin" placeholder="Employee Number" required>
<button onclick="empLogin()">Login</button>
</div>

<!-- ================= EMPLOYEE SURVEY ================= -->
<div id="empSurvey" class="hidden">
<h3>Pulse Survey</h3>
<p><b>Employee No:</b> <span id="empDisplay"></span></p>

<label>Department</label>
<input type="text" id="dept" readonly>

<label>1. Work Satisfaction</label>
<select id="q1"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<label>2. Team Support</label>
<select id="q2"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<label>3. Manager Communication</label>
<select id="q3"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<label>4. Workload Balance</label>
<select id="q4"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<label>5. Overall Happiness</label>
<select id="q5"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>

<br><br>
<button onclick="submitSurvey()">Submit Survey</button>
</div>

<!-- ================= HR ADMIN LOGIN ================= -->
<div id="HRadminLogin" class="hidden">
<h3>HR Admin Login</h3>
<input type="text" id="adminUser" placeholder="Username">
<input type="password" id="adminPass" placeholder="Password">
<button onclick="HRadminLogin()">Login</button>
</div>

<!-- ================= HR ADMIN PANEL ================= -->
<div id="HRadminPanel" class="hidden">
<h3>HR Admin Dashboard</h3>

<h4>Upload Employee Master (CSV)</h4>
<p><b>Format:</b> EmpNo,Department</p>
<input type="file" id="empFile" accept=".csv">
<button onclick="uploadEmployees()">Upload</button>
<p id="uploadStatus"></p>

<button onclick="loadData()">Refresh</button>
<button onclick="downloadExcel()">Download Excel</button>
<button onclick="clearData()">Clear All</button>

<table>
<thead>
<tr>
<th>Emp No</th>
<th>Dept</th>
<th>Q1</th>
<th>Q2</th>
<th>Q3</th>
<th>Q4</th>
<th>Q5</th>
<th>Average</th>
</tr>
</thead>
<tbody id="dataTable"></tbody>
</table>
</div>
</div>

<script>
/* ========== ADMIN CREDENTIALS ========== */
const ADMIN_USER = "admin";
const ADMIN_PASS = "admin@123";

/* ========== GLOBAL DATA ========== */
let currentEmp = "";
let employeeMaster = JSON.parse(localStorage.getItem("employeeMaster")) || {};

/* ========== NAVIGATION ========== */
function hideAll() {
    ["empLogin","empSurvey","HRadminLogin","HRadminPanel"].forEach(id =>
        document.getElementById(id).classList.add("hidden")
    );
}

function showEmpLogin() {
    hideAll();
    document.getElementById("empLogin").classList.remove("hidden");
}

function showHRAdminLogin() {
    hideAll();
    document.getElementById("HRadminLogin").classList.remove("hidden");
}

/* ========== HR ADMIN LOGIN ========== */
function HRadminLogin() {
    let user = document.getElementById("adminUser").value.trim();
    let pass = document.getElementById("adminPass").value.trim();

    if (user === ADMIN_USER && pass === ADMIN_PASS) {
        hideAll();
        document.getElementById("HRadminPanel").classList.remove("hidden");
        loadData();
    } else {
        alert("Invalid HR Admin Username or Password");
    }
}

/* ========== UPLOAD EMPLOYEE MASTER ========== */
function uploadEmployees() {
    let file = document.getElementById("empFile").files[0];
    if (!file) return alert("Select CSV file");

    let reader = new FileReader();
    reader.onload = e => {
        let rows = e.target.result.split("\n");
        employeeMaster = {};
        rows.slice(1).forEach(r => {
            let c = r.split(",");
            if (c[0]) employeeMaster[c[0].trim()] = { dept:c[1]?.trim() };
        });
        localStorage.setItem("employeeMaster", JSON.stringify(employeeMaster));
        uploadStatus.innerText = "Employees Uploaded: " + Object.keys(employeeMaster).length;
    };
    reader.readAsText(file);
}

/* ========== EMPLOYEE LOGIN WITHOUT DOB ========== */
function empLogin() {
    let empNo = empNoLogin.value.trim();

    if (!employeeMaster[empNo]) return alert("Employee not authorized");

    let data = JSON.parse(localStorage.getItem("surveyData")) || [];
    if (data.some(d => d.empNo === empNo)) return alert("Survey already submitted");

    currentEmp = empNo;
    empDisplay.innerText = empNo;
    dept.value = employeeMaster[empNo].dept;

    hideAll();
    document.getElementById("empSurvey").classList.remove("hidden");
}

/* ========== SUBMIT SURVEY ========== */
function submitSurvey() {
    let data = JSON.parse(localStorage.getItem("surveyData")) || [];
    data.push({
        empNo: currentEmp,
        dept: dept.value,
        q1: +q1.value,
        q2: +q2.value,
        q3: +q3.value,
        q4: +q4.value,
        q5: +q5.value
    });
    localStorage.setItem("surveyData", JSON.stringify(data));
    alert("Survey Submitted Successfully");
    hideAll();
    showEmpLogin();
}

/* ========== LOAD DATA ========== */
function loadData() {
    dataTable.innerHTML="";
    (JSON.parse(localStorage.getItem("surveyData"))||[]).forEach(r=>{
        let avg=((r.q1+r.q2+r.q3+r.q4+r.q5)/5).toFixed(2);
        dataTable.innerHTML+=`
<tr><td>${r.empNo}</td><td>${r.dept}</td>
<td>${r.q1}</td><td>${r.q2}</td><td>${r.q3}</td>
<td>${r.q4}</td><td>${r.q5}</td><td>${avg}</td></tr>`;
    });
}

/* ========== DOWNLOAD EXCEL ========== */
function downloadExcel() {
    let data = JSON.parse(localStorage.getItem("surveyData")) || [];
    if (!data.length) return alert("No data available");

    let csv="Emp No,Dept,Q1,Q2,Q3,Q4,Q5,Average\n";
    data.forEach(r=>{
        let avg=((r.q1+r.q2+r.q3+r.q4+r.q5)/5).toFixed(2);
        csv+=`${r.empNo},${r.dept},${r.q1},${r.q2},${r.q3},${r.q4},${r.q5},${avg}\n`;
    });
    let blob=new Blob([csv],{type:"text/csv"});
    let a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="Pulse_Survey_Report.csv";
    a.click();
}

/* ========== CLEAR DATA ========== */
function clearData() {
    if(confirm("Delete all survey data?")){
        localStorage.removeItem("surveyData");
        loadData();
    }
}
</script>

</body>
</html>
