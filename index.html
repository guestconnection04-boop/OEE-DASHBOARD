<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MPTEPL OEE Dashboard</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
body{
    font-family:Arial;
    background:linear-gradient(120deg,#1e3c72,#2a5298);
    margin:0;padding:20px;
}

.container{
    max-width:1200px;
    margin:auto;
    background:#fff;
    padding:25px;
    border-radius:12px;
}

h2{text-align:center;color:#1e3c72;}
h3{margin-top:25px;color:#1e3c72;}

.top-bar{
    display:flex;
    justify-content:space-between;
    margin-bottom:15px;
}

button,input[type=file]{
    padding:10px;
    border-radius:6px;
    border:none;
}

button{
    background:#1e3c72;
    color:white;
    cursor:pointer;
}

.cards{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:15px;
    margin-bottom:20px;
}

.card{
    padding:20px;
    border-radius:10px;
    text-align:center;
    font-weight:bold;
}

.avail{background:#ffeaa7;}
.perf{background:#81ecec;}
.qual{background:#a29bfe;}
.oee{background:#55efc4;font-size:22px;}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:15px;
}

th,td{
    border:1px solid #ddd;
    padding:10px;
    text-align:center;
}

th{
    background:#1e3c72;
    color:white;
}

/* ADMIN MODAL */
.modal{
    display:none;
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.5);
}
.modal-box{
    background:#fff;
    padding:25px;
    max-width:350px;
    margin:150px auto;
    border-radius:10px;
}
.modal-box input{
    width:100%;
    padding:10px;
    margin-top:10px;
}
</style>
</head>

<body>

<div class="container">

<h2>ðŸ“Š MPTEPL OEE Dashboard</h2>

<div class="top-bar">
    <div id="adminControls" style="display:none;">
        <input type="file" id="upload" accept=".xlsx,.xls">
        <button onclick="exportExcel()">â¬‡ Export</button>
    </div>
    <div>
        <button onclick="openAdmin()">Admin Login</button>
        <button onclick="logout()" id="logoutBtn" style="display:none;">Logout</button>
    </div>
</div>

<!-- OVERALL OEE -->
<div class="cards">
    <div class="card avail">Availability<br><span id="availability">0%</span></div>
    <div class="card perf">Performance<br><span id="performance">0%</span></div>
    <div class="card qual">Quality<br><span id="quality">0%</span></div>
    <div class="card oee">Overall OEE<br><span id="oee">0%</span></div>
</div>

<!-- CONVEYOR WISE -->
<h3>Conveyor-wise OEE</h3>
<table id="dataTable">
<thead>
<tr>
    <th>Conveyor</th>
    <th>Availability</th>
    <th>Performance</th>
    <th>Quality</th>
    <th>OEE</th>
</tr>
</thead>
<tbody></tbody>
</table>

</div>

<!-- ADMIN LOGIN MODAL -->
<div class="modal" id="adminModal">
    <div class="modal-box">
        <h3>Admin Access</h3>
        <input type="password" id="adminPass" placeholder="Enter Admin Password">
        <button onclick="adminLogin()" style="margin-top:10px;width:100%;">Login</button>
    </div>
</div>

<script>
let excelData=[];
let isAdmin=false;

/* ADMIN LOGIN */
function openAdmin(){
    document.getElementById("adminModal").style.display="block";
}

function adminLogin(){
    if(document.getElementById("adminPass").value==="admin123"){
        isAdmin=true;
        document.getElementById("adminControls").style.display="block";
        document.getElementById("logoutBtn").style.display="inline-block";
        document.getElementById("adminModal").style.display="none";
    }else{
        alert("Invalid Password");
    }
}

function logout(){
    location.reload();
}

/* FILE UPLOAD */
document.getElementById("upload")?.addEventListener("change",function(e){
    const reader=new FileReader();
    reader.onload=function(e){
        const wb=XLSX.read(e.target.result,{type:"binary"});
        const sheet=wb.Sheets[wb.SheetNames[0]];
        excelData=XLSX.utils.sheet_to_json(sheet);
        calculateDashboard();
    };
    reader.readAsBinaryString(e.target.files[0]);
});

function calculateDashboard(){
    let map={};

    excelData.forEach(r=>{
        if(!map[r.Conveyor]) map[r.Conveyor]=[];
        map[r.Conveyor].push(r);
    });

    let tbody=document.querySelector("#dataTable tbody");
    tbody.innerHTML="";

    let A=0,P=0,Q=0,c=0;

    for(let conv in map){
        let tA=0,tP=0,tQ=0;
        map[conv].forEach(r=>{
            let op=r.PlannedTime-r.Downtime;
            tA+=op/r.PlannedTime;
            tP+=(r.IdealCycleTime*r.TotalCount)/op;
            tQ+=r.GoodCount/r.TotalCount;
        });

        let n=map[conv].length;
        let a=tA/n,p=tP/n,q=tQ/n,o=a*p*q;

        tbody.innerHTML+=`
        <tr>
            <td>${conv}</td>
            <td>${(a*100).toFixed(2)}%</td>
            <td>${(p*100).toFixed(2)}%</td>
            <td>${(q*100).toFixed(2)}%</td>
            <td><b>${(o*100).toFixed(2)}%</b></td>
        </tr>`;

        A+=a; P+=p; Q+=q; c++;
    }

    availability.innerHTML=((A/c)*100).toFixed(2)+"%";
    performance.innerHTML=((P/c)*100).toFixed(2)+"%";
    quality.innerHTML=((Q/c)*100).toFixed(2)+"%";
    oee.innerHTML=(((A/c)*(P/c)*(Q/c))*100).toFixed(2)+"%";
}

function exportExcel(){
    if(!isAdmin) return;
    const ws=XLSX.utils.json_to_sheet(excelData);
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"MPTEPL_OEE");
    XLSX.writeFile(wb,"MPTEPL_OEE_Report.xlsx");
}
</script>

</body>
</html>
